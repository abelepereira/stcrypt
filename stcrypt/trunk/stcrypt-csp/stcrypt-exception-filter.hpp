//================================================================================================================================================
// FILE: stcrypt-exception-filter.h
// (c) GIE 2009-11-02  13:18
//
//================================================================================================================================================
#ifndef H_GUARD_STCRYPT_EXCEPTION_FILTER_2009_11_02_13_18
#define H_GUARD_STCRYPT_EXCEPTION_FILTER_2009_11_02_13_18
//================================================================================================================================================
#pragma once
//================================================================================================================================================
#include "stcrypt-exceptions.hpp"
#include "stcrypt-debug.hpp"
//================================================================================================================================================
//TODO: implement exception filter
#define CSP_CPP_EXCEPTION_GUARD_BEGIN	try {
#define CSP_CPP_EXCEPTION_GUARD_END	\
	} catch(...){ \
        DWORD const err_code = ::stcrypt::csp_exception_filter();   \
        STCRYPT_LOG_PRINT_EX("SetlastError()", err_code);           \
        SetLastError(err_code);                                     \
        return (err_code==ERROR_SUCCESS?TRUE:FALSE);                \
    }	                                                            \
    STCRYPT_LOG_PRINT_EX("SetlastError()", ERROR_SUCCESS);          \
    SetLastError(ERROR_SUCCESS);                                    \
    return TRUE;                                                    \
    /**/

namespace stcrypt {
	DWORD csp_exception_filter();
}
//================================================================================================================================================
#endif
//================================================================================================================================================
